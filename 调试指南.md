# 视频缩略图调试指南

## 如何查看日志

### 在 Android Studio 中查看 Logcat

1. **打开 Logcat**
   - 点击底部的 "Logcat" 标签
   - 或使用快捷键：`Alt+6` (Windows/Linux) 或 `Cmd+6` (Mac)

2. **过滤日志**
   - 在搜索框输入：`VideoThumbnail`
   - 只显示我们的调试信息

3. **查看关键信息**
   需要关注的日志：
   ```
   ✅ Creating VideoThumbnailFetcher for content://...
   ✅ Loading thumbnail for: content://...
   ✅ Thumbnail loaded successfully
   
   或者错误信息：
   ❌ Failed to get MIME type
   ❌ loadThumbnail failed
   ❌ Thumbnail is null
   ```

## 常见问题及解决方案

### 问题 1: 看到 "Creating VideoThumbnailFetcher" 但缩略图还是不显示

**可能原因：**
- Android 系统还没有为视频生成缩略图
- 视频文件损坏或格式不支持

**解决方案：**
1. 在手机的系统相册中打开视频一次
2. 等待几秒让系统生成缩略图
3. 返回我们的应用并刷新

### 问题 2: 没有看到 "Creating VideoThumbnailFetcher" 日志

**可能原因：**
- Coil 没有识别到视频 MIME 类型
- URI 格式问题

**解决方案：**
检查日志中 "URI: xxx, MIME: xxx" 的内容
- MIME 应该是 "video/mp4" 或其他 video/* 格式
- 如果 MIME 是 null，说明权限或 URI 有问题

### 问题 3: 看到 "loadThumbnail failed" 错误

**可能原因：**
- Android 系统缩略图缓存问题
- 视频文件权限问题

**解决方案：**
应用会自动使用备用方案 (ThumbnailUtils)
如果还是失败，检查是否授予了所有文件访问权限

## 手动测试步骤

1. **清除应用数据**
   ```
   设置 → 应用 → MediaExplorer → 存储 → 清除数据
   ```

2. **重新授予权限**
   - 启动应用
   - 授予 "所有文件访问权限"

3. **打开系统相册**
   - 浏览一遍你的视频
   - 确保系统已生成缩略图

4. **打开 MediaExplorer**
   - 切换到"视频"标签
   - 查看缩略图是否显示

5. **查看 Logcat**
   - 在 Android Studio 中查看日志
   - 搜索 "VideoThumbnail"

## 预期日志输出

### 正常情况（成功）：
```
D/VideoThumbnail: URI: content://media/external/video/media/123, MIME: video/mp4
D/VideoThumbnail: Creating VideoThumbnailFetcher for content://media/external/video/media/123
D/VideoThumbnail: Loading thumbnail for: content://media/external/video/media/123
D/VideoThumbnail: Thumbnail loaded successfully
```

### 使用备用方案：
```
D/VideoThumbnail: URI: content://media/external/video/media/123, MIME: video/mp4
D/VideoThumbnail: Creating VideoThumbnailFetcher for content://media/external/video/media/123
D/VideoThumbnail: Loading thumbnail for: content://media/external/video/media/123
E/VideoThumbnail: loadThumbnail failed: xxx
D/VideoThumbnail: Video path: /storage/emulated/0/DCIM/Camera/video.mp4
D/VideoThumbnail: Thumbnail loaded successfully
```

### 失败情况：
```
D/VideoThumbnail: URI: content://media/external/video/media/123, MIME: video/mp4
D/VideoThumbnail: Creating VideoThumbnailFetcher for content://media/external/video/media/123
D/VideoThumbnail: Loading thumbnail for: content://media/external/video/media/123
E/VideoThumbnail: loadThumbnail failed: xxx
E/VideoThumbnail: generateThumbnailFromPath failed: xxx
E/VideoThumbnail: Thumbnail is null
E/VideoThumbnail: Fetch failed: Failed to load video thumbnail
```

## 临时解决方案

如果以上方法都不行，可以使用以下临时方案：

### 方案 A: 显示默认图标
视频显示播放图标而不是缩略图（当前方案）

### 方案 B: 延迟加载
第一次打开详情页时生成缩略图并缓存

### 方案 C: 使用低分辨率缩略图
降低缩略图质量要求

## 需要提供的调试信息

如果问题依然存在，请提供：
1. **Logcat 日志** - 过滤 "VideoThumbnail" 的所有输出
2. **视频信息** - 一个示例视频的详细信息
3. **设备信息** - Android 版本、设备型号
4. **权限状态** - 是否已授予所有文件访问权限

## 下一步

运行应用后：
1. 切换到"视频"标签
2. 在 Android Studio 打开 Logcat
3. 搜索 "VideoThumbnail"
4. 查看日志输出

把日志内容发给我，我可以帮你分析具体问题！

