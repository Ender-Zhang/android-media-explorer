# MediaExplorer 快速开始指南

本指南将帮助你快速上手 MediaExplorer Android 应用的开发和使用。

## 📱 用户快速开始

### 安装应用
1. 下载 APK 文件到 Android 手机
2. 在手机上打开 APK 文件
3. 允许"从此来源安装应用"
4. 点击"安装"

### 首次使用
1. **打开应用**
   - 点击桌面上的"媒体浏览器"图标

2. **授予权限**
   - 应用会提示需要存储权限
   - 点击"授予权限"按钮
   - 在弹出的系统设置页面中：
     - Android 11-13: 选择"允许访问所有文件"
     - Android 13+: 允许访问"照片和视频"

3. **等待扫描**
   - 返回应用后会自动扫描媒体文件
   - 显示加载动画，请耐心等待

4. **开始浏览**
   - 扫描完成后，所有照片和视频以网格形式展示
   - 点击任意项查看详细信息

### 基本操作
- **切换类型**：点击顶部的"全部"、"照片"、"视频"标签
- **查看详情**：点击任意媒体项
- **刷新列表**：点击右上角的刷新图标
- **关闭详情**：点击详情页左上角的 X 按钮

## 💻 开发者快速开始

### 环境准备
```bash
# 检查 Java 版本（需要 JDK 17+）
java -version

# 安装 Android Studio（如果还没有）
# 访问：https://developer.android.com/studio
```

### 项目导入
1. **打开 Android Studio**
2. **导入项目**
   ```
   File → Open → 选择 MediaExplorer 文件夹
   ```
3. **等待 Gradle 同步**
   - 首次打开会自动下载依赖
   - 可能需要 5-10 分钟

### 运行项目
```bash
# 使用命令行（推荐用于 CI/CD）
cd /Users/yuchenzhang/cs/playground/MediaExplorer

# 构建 Debug 版本
./gradlew assembleDebug

# 安装到连接的设备
./gradlew installDebug

# 或直接运行
./gradlew assembleDebug

adb install app/build/outputs/apk/debug/app-debug.apk
```

**在 Android Studio 中运行**：
1. 连接 Android 设备或启动模拟器
2. 点击工具栏的运行按钮 ▶ (或按 Shift+F10)
3. 选择目标设备
4. 等待应用启动

### 调试技巧
```kotlin
// 在需要调试的地方添加日志
import android.util.Log

Log.d("MediaExplorer", "扫描到 ${mediaItems.size} 个媒体文件")
Log.e("MediaExplorer", "扫描失败: ${e.message}")
```

**使用 Android Studio Logcat**：
1. 点击底部的 "Logcat" 标签
2. 搜索 "MediaExplorer" 查看应用日志
3. 选择过滤级别（Verbose/Debug/Info/Warn/Error）

## 🔧 常见开发问题

### 问题 1: Gradle 同步失败
**解决方案**：
```bash
# 清理项目
./gradlew clean

# 删除 .gradle 文件夹
rm -rf .gradle

# 重新同步
./gradlew build --refresh-dependencies
```

### 问题 2: 依赖下载慢
**解决方案**：
在 `build.gradle` 中添加镜像源：
```gradle
repositories {
    maven { url 'https://maven.aliyun.com/repository/google' }
    maven { url 'https://maven.aliyun.com/repository/public' }
    google()
    mavenCentral()
}
```

### 问题 3: 构建错误
**解决方案**：
```bash
# 查看详细错误信息
./gradlew build --stacktrace

# 强制刷新依赖
./gradlew build --refresh-dependencies
```

### 问题 4: 模拟器运行慢
**解决方案**：
1. 使用硬件加速（HAXM/KVM）
2. 选择较新的系统镜像（x86_64）
3. 增加模拟器的 RAM 和 VM Heap
4. 或使用真实设备测试

## 📖 代码结构快速导览

### 核心文件
```
MediaExplorer/
├── MainActivity.kt           # 入口 Activity，处理权限
├── MediaItem.kt             # 数据模型
├── MediaScanner.kt          # 媒体扫描逻辑
├── MediaViewModel.kt        # 业务逻辑和状态管理
├── MediaExplorerApp.kt      # 主界面 UI
├── MediaDetailDialog.kt     # 详情对话框
└── PermissionScreen.kt      # 权限请求界面
```

### 修改建议流程
1. **修改 UI** → 编辑 `MediaExplorerApp.kt` 或相关 Compose 文件
2. **修改数据模型** → 编辑 `MediaItem.kt`
3. **修改扫描逻辑** → 编辑 `MediaScanner.kt`
4. **修改业务逻辑** → 编辑 `MediaViewModel.kt`
5. **修改权限** → 编辑 `AndroidManifest.xml`

## 🎨 自定义应用

### 更改应用名称
编辑 `app/src/main/res/values/strings.xml`：
```xml
<string name="app_name">我的媒体浏览器</string>
```

### 更改应用图标
替换 `app/src/main/res/drawable/ic_launcher.xml`

### 更改主题颜色
编辑 `MainActivity.kt` 中的 `MaterialTheme`：
```kotlin
MaterialTheme(
    colorScheme = lightColorScheme(
        primary = Color(0xFF6200EE),
        secondary = Color(0xFF03DAC5)
    ),
    content = content
)
```

### 添加新功能
1. 在 `MediaViewModel.kt` 中添加新的状态和方法
2. 在相应的 UI 文件中添加 UI 组件
3. 连接 ViewModel 和 UI

## 📦 发布应用

### 生成签名密钥
```bash
keytool -genkey -v -keystore my-release-key.jks \
  -keyalg RSA -keysize 2048 -validity 10000 \
  -alias my-key-alias
```

### 配置签名
在 `app/build.gradle` 中添加：
```gradle
android {
    signingConfigs {
        release {
            storeFile file("my-release-key.jks")
            storePassword "密码"
            keyAlias "my-key-alias"
            keyPassword "密码"
        }
    }
    buildTypes {
        release {
            signingConfig signingConfigs.release
        }
    }
}
```

### 构建 Release 版本
```bash
./gradlew assembleRelease
```

输出文件：`app/build/outputs/apk/release/app-release.apk`

## 🚀 性能优化

### 1. 减少扫描时间
在 `MediaScanner.kt` 中添加限制：
```kotlin
// 只扫描最近的 1000 个文件
val query = context.contentResolver.query(
    MediaStore.Images.Media.EXTERNAL_CONTENT_URI,
    projection,
    null,
    null,
    "${MediaStore.Images.Media.DATE_MODIFIED} DESC LIMIT 1000"
)
```

### 2. 优化图片加载
在 `app/build.gradle` 中配置 Coil：
```kotlin
// 在 Application 类中初始化
ImageLoader.Builder(context)
    .memoryCache {
        MemoryCache.Builder(context)
            .maxSizePercent(0.25)
            .build()
    }
    .build()
```

### 3. 启用 R8 代码压缩
在 `app/build.gradle` 中：
```gradle
buildTypes {
    release {
        minifyEnabled true
        shrinkResources true
    }
}
```

## 📚 学习资源

- [Jetpack Compose 官方文档](https://developer.android.com/jetpack/compose)
- [Kotlin 协程指南](https://kotlinlang.org/docs/coroutines-guide.html)
- [Android MediaStore API](https://developer.android.com/reference/android/provider/MediaStore)
- [Material Design 3](https://m3.material.io/)

## 💡 下一步

1. ✅ 成功运行应用
2. ✅ 理解项目结构
3. 📝 尝试修改 UI（改变颜色、布局等）
4. 🔧 添加新功能（如搜索、排序）
5. 📱 发布到 Google Play Store

---

**祝你开发愉快！** 🎉

如有问题，请查阅完整的 README.md 文档或提交 Issue。


