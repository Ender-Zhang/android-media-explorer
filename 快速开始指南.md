# MediaExplorer å¿«é€Ÿå¼€å§‹æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ å¿«é€Ÿä¸Šæ‰‹ MediaExplorer Android åº”ç”¨çš„å¼€å‘å’Œä½¿ç”¨ã€‚

## ğŸ“± ç”¨æˆ·å¿«é€Ÿå¼€å§‹

### å®‰è£…åº”ç”¨
1. ä¸‹è½½ APK æ–‡ä»¶åˆ° Android æ‰‹æœº
2. åœ¨æ‰‹æœºä¸Šæ‰“å¼€ APK æ–‡ä»¶
3. å…è®¸"ä»æ­¤æ¥æºå®‰è£…åº”ç”¨"
4. ç‚¹å‡»"å®‰è£…"

### é¦–æ¬¡ä½¿ç”¨
1. **æ‰“å¼€åº”ç”¨**
   - ç‚¹å‡»æ¡Œé¢ä¸Šçš„"åª’ä½“æµè§ˆå™¨"å›¾æ ‡

2. **æˆäºˆæƒé™**
   - åº”ç”¨ä¼šæç¤ºéœ€è¦å­˜å‚¨æƒé™
   - ç‚¹å‡»"æˆäºˆæƒé™"æŒ‰é’®
   - åœ¨å¼¹å‡ºçš„ç³»ç»Ÿè®¾ç½®é¡µé¢ä¸­ï¼š
     - Android 11-13: é€‰æ‹©"å…è®¸è®¿é—®æ‰€æœ‰æ–‡ä»¶"
     - Android 13+: å…è®¸è®¿é—®"ç…§ç‰‡å’Œè§†é¢‘"

3. **ç­‰å¾…æ‰«æ**
   - è¿”å›åº”ç”¨åä¼šè‡ªåŠ¨æ‰«æåª’ä½“æ–‡ä»¶
   - æ˜¾ç¤ºåŠ è½½åŠ¨ç”»ï¼Œè¯·è€å¿ƒç­‰å¾…

4. **å¼€å§‹æµè§ˆ**
   - æ‰«æå®Œæˆåï¼Œæ‰€æœ‰ç…§ç‰‡å’Œè§†é¢‘ä»¥ç½‘æ ¼å½¢å¼å±•ç¤º
   - ç‚¹å‡»ä»»æ„é¡¹æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯

### åŸºæœ¬æ“ä½œ
- **åˆ‡æ¢ç±»å‹**ï¼šç‚¹å‡»é¡¶éƒ¨çš„"å…¨éƒ¨"ã€"ç…§ç‰‡"ã€"è§†é¢‘"æ ‡ç­¾
- **æŸ¥çœ‹è¯¦æƒ…**ï¼šç‚¹å‡»ä»»æ„åª’ä½“é¡¹
- **åˆ·æ–°åˆ—è¡¨**ï¼šç‚¹å‡»å³ä¸Šè§’çš„åˆ·æ–°å›¾æ ‡
- **å…³é—­è¯¦æƒ…**ï¼šç‚¹å‡»è¯¦æƒ…é¡µå·¦ä¸Šè§’çš„ X æŒ‰é’®

## ğŸ’» å¼€å‘è€…å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒå‡†å¤‡
```bash
# æ£€æŸ¥ Java ç‰ˆæœ¬ï¼ˆéœ€è¦ JDK 17+ï¼‰
java -version

# å®‰è£… Android Studioï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
# è®¿é—®ï¼šhttps://developer.android.com/studio
```

### é¡¹ç›®å¯¼å…¥
1. **æ‰“å¼€ Android Studio**
2. **å¯¼å…¥é¡¹ç›®**
   ```
   File â†’ Open â†’ é€‰æ‹© MediaExplorer æ–‡ä»¶å¤¹
   ```
3. **ç­‰å¾… Gradle åŒæ­¥**
   - é¦–æ¬¡æ‰“å¼€ä¼šè‡ªåŠ¨ä¸‹è½½ä¾èµ–
   - å¯èƒ½éœ€è¦ 5-10 åˆ†é’Ÿ

### è¿è¡Œé¡¹ç›®
```bash
# ä½¿ç”¨å‘½ä»¤è¡Œï¼ˆæ¨èç”¨äº CI/CDï¼‰
cd /Users/yuchenzhang/cs/playground/MediaExplorer

# æ„å»º Debug ç‰ˆæœ¬
./gradlew assembleDebug

# å®‰è£…åˆ°è¿æ¥çš„è®¾å¤‡
./gradlew installDebug

# æˆ–ç›´æ¥è¿è¡Œ
./gradlew assembleDebug

adb install app/build/outputs/apk/debug/app-debug.apk
```

**åœ¨ Android Studio ä¸­è¿è¡Œ**ï¼š
1. è¿æ¥ Android è®¾å¤‡æˆ–å¯åŠ¨æ¨¡æ‹Ÿå™¨
2. ç‚¹å‡»å·¥å…·æ çš„è¿è¡ŒæŒ‰é’® â–¶ (æˆ–æŒ‰ Shift+F10)
3. é€‰æ‹©ç›®æ ‡è®¾å¤‡
4. ç­‰å¾…åº”ç”¨å¯åŠ¨

### è°ƒè¯•æŠ€å·§
```kotlin
// åœ¨éœ€è¦è°ƒè¯•çš„åœ°æ–¹æ·»åŠ æ—¥å¿—
import android.util.Log

Log.d("MediaExplorer", "æ‰«æåˆ° ${mediaItems.size} ä¸ªåª’ä½“æ–‡ä»¶")
Log.e("MediaExplorer", "æ‰«æå¤±è´¥: ${e.message}")
```

**ä½¿ç”¨ Android Studio Logcat**ï¼š
1. ç‚¹å‡»åº•éƒ¨çš„ "Logcat" æ ‡ç­¾
2. æœç´¢ "MediaExplorer" æŸ¥çœ‹åº”ç”¨æ—¥å¿—
3. é€‰æ‹©è¿‡æ»¤çº§åˆ«ï¼ˆVerbose/Debug/Info/Warn/Errorï¼‰

## ğŸ”§ å¸¸è§å¼€å‘é—®é¢˜

### é—®é¢˜ 1: Gradle åŒæ­¥å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ¸…ç†é¡¹ç›®
./gradlew clean

# åˆ é™¤ .gradle æ–‡ä»¶å¤¹
rm -rf .gradle

# é‡æ–°åŒæ­¥
./gradlew build --refresh-dependencies
```

### é—®é¢˜ 2: ä¾èµ–ä¸‹è½½æ…¢
**è§£å†³æ–¹æ¡ˆ**ï¼š
åœ¨ `build.gradle` ä¸­æ·»åŠ é•œåƒæºï¼š
```gradle
repositories {
    maven { url 'https://maven.aliyun.com/repository/google' }
    maven { url 'https://maven.aliyun.com/repository/public' }
    google()
    mavenCentral()
}
```

### é—®é¢˜ 3: æ„å»ºé”™è¯¯
**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
./gradlew build --stacktrace

# å¼ºåˆ¶åˆ·æ–°ä¾èµ–
./gradlew build --refresh-dependencies
```

### é—®é¢˜ 4: æ¨¡æ‹Ÿå™¨è¿è¡Œæ…¢
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿï¼ˆHAXM/KVMï¼‰
2. é€‰æ‹©è¾ƒæ–°çš„ç³»ç»Ÿé•œåƒï¼ˆx86_64ï¼‰
3. å¢åŠ æ¨¡æ‹Ÿå™¨çš„ RAM å’Œ VM Heap
4. æˆ–ä½¿ç”¨çœŸå®è®¾å¤‡æµ‹è¯•

## ğŸ“– ä»£ç ç»“æ„å¿«é€Ÿå¯¼è§ˆ

### æ ¸å¿ƒæ–‡ä»¶
```
MediaExplorer/
â”œâ”€â”€ MainActivity.kt           # å…¥å£ Activityï¼Œå¤„ç†æƒé™
â”œâ”€â”€ MediaItem.kt             # æ•°æ®æ¨¡å‹
â”œâ”€â”€ MediaScanner.kt          # åª’ä½“æ‰«æé€»è¾‘
â”œâ”€â”€ MediaViewModel.kt        # ä¸šåŠ¡é€»è¾‘å’ŒçŠ¶æ€ç®¡ç†
â”œâ”€â”€ MediaExplorerApp.kt      # ä¸»ç•Œé¢ UI
â”œâ”€â”€ MediaDetailDialog.kt     # è¯¦æƒ…å¯¹è¯æ¡†
â””â”€â”€ PermissionScreen.kt      # æƒé™è¯·æ±‚ç•Œé¢
```

### ä¿®æ”¹å»ºè®®æµç¨‹
1. **ä¿®æ”¹ UI** â†’ ç¼–è¾‘ `MediaExplorerApp.kt` æˆ–ç›¸å…³ Compose æ–‡ä»¶
2. **ä¿®æ”¹æ•°æ®æ¨¡å‹** â†’ ç¼–è¾‘ `MediaItem.kt`
3. **ä¿®æ”¹æ‰«æé€»è¾‘** â†’ ç¼–è¾‘ `MediaScanner.kt`
4. **ä¿®æ”¹ä¸šåŠ¡é€»è¾‘** â†’ ç¼–è¾‘ `MediaViewModel.kt`
5. **ä¿®æ”¹æƒé™** â†’ ç¼–è¾‘ `AndroidManifest.xml`

## ğŸ¨ è‡ªå®šä¹‰åº”ç”¨

### æ›´æ”¹åº”ç”¨åç§°
ç¼–è¾‘ `app/src/main/res/values/strings.xml`ï¼š
```xml
<string name="app_name">æˆ‘çš„åª’ä½“æµè§ˆå™¨</string>
```

### æ›´æ”¹åº”ç”¨å›¾æ ‡
æ›¿æ¢ `app/src/main/res/drawable/ic_launcher.xml`

### æ›´æ”¹ä¸»é¢˜é¢œè‰²
ç¼–è¾‘ `MainActivity.kt` ä¸­çš„ `MaterialTheme`ï¼š
```kotlin
MaterialTheme(
    colorScheme = lightColorScheme(
        primary = Color(0xFF6200EE),
        secondary = Color(0xFF03DAC5)
    ),
    content = content
)
```

### æ·»åŠ æ–°åŠŸèƒ½
1. åœ¨ `MediaViewModel.kt` ä¸­æ·»åŠ æ–°çš„çŠ¶æ€å’Œæ–¹æ³•
2. åœ¨ç›¸åº”çš„ UI æ–‡ä»¶ä¸­æ·»åŠ  UI ç»„ä»¶
3. è¿æ¥ ViewModel å’Œ UI

## ğŸ“¦ å‘å¸ƒåº”ç”¨

### ç”Ÿæˆç­¾åå¯†é’¥
```bash
keytool -genkey -v -keystore my-release-key.jks \
  -keyalg RSA -keysize 2048 -validity 10000 \
  -alias my-key-alias
```

### é…ç½®ç­¾å
åœ¨ `app/build.gradle` ä¸­æ·»åŠ ï¼š
```gradle
android {
    signingConfigs {
        release {
            storeFile file("my-release-key.jks")
            storePassword "å¯†ç "
            keyAlias "my-key-alias"
            keyPassword "å¯†ç "
        }
    }
    buildTypes {
        release {
            signingConfig signingConfigs.release
        }
    }
}
```

### æ„å»º Release ç‰ˆæœ¬
```bash
./gradlew assembleRelease
```

è¾“å‡ºæ–‡ä»¶ï¼š`app/build/outputs/apk/release/app-release.apk`

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### 1. å‡å°‘æ‰«ææ—¶é—´
åœ¨ `MediaScanner.kt` ä¸­æ·»åŠ é™åˆ¶ï¼š
```kotlin
// åªæ‰«ææœ€è¿‘çš„ 1000 ä¸ªæ–‡ä»¶
val query = context.contentResolver.query(
    MediaStore.Images.Media.EXTERNAL_CONTENT_URI,
    projection,
    null,
    null,
    "${MediaStore.Images.Media.DATE_MODIFIED} DESC LIMIT 1000"
)
```

### 2. ä¼˜åŒ–å›¾ç‰‡åŠ è½½
åœ¨ `app/build.gradle` ä¸­é…ç½® Coilï¼š
```kotlin
// åœ¨ Application ç±»ä¸­åˆå§‹åŒ–
ImageLoader.Builder(context)
    .memoryCache {
        MemoryCache.Builder(context)
            .maxSizePercent(0.25)
            .build()
    }
    .build()
```

### 3. å¯ç”¨ R8 ä»£ç å‹ç¼©
åœ¨ `app/build.gradle` ä¸­ï¼š
```gradle
buildTypes {
    release {
        minifyEnabled true
        shrinkResources true
    }
}
```

## ğŸ“š å­¦ä¹ èµ„æº

- [Jetpack Compose å®˜æ–¹æ–‡æ¡£](https://developer.android.com/jetpack/compose)
- [Kotlin åç¨‹æŒ‡å—](https://kotlinlang.org/docs/coroutines-guide.html)
- [Android MediaStore API](https://developer.android.com/reference/android/provider/MediaStore)
- [Material Design 3](https://m3.material.io/)

## ğŸ’¡ ä¸‹ä¸€æ­¥

1. âœ… æˆåŠŸè¿è¡Œåº”ç”¨
2. âœ… ç†è§£é¡¹ç›®ç»“æ„
3. ğŸ“ å°è¯•ä¿®æ”¹ UIï¼ˆæ”¹å˜é¢œè‰²ã€å¸ƒå±€ç­‰ï¼‰
4. ğŸ”§ æ·»åŠ æ–°åŠŸèƒ½ï¼ˆå¦‚æœç´¢ã€æ’åºï¼‰
5. ğŸ“± å‘å¸ƒåˆ° Google Play Store

---

**ç¥ä½ å¼€å‘æ„‰å¿«ï¼** ğŸ‰

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥é˜…å®Œæ•´çš„ README.md æ–‡æ¡£æˆ–æäº¤ Issueã€‚


