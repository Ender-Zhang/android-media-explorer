# 视频播放功能说明

## 功能概述

MediaExplorer 已集成完整的视频播放功能，使用 Google 的 ExoPlayer 媒体框架实现。

## 主要特性

### ✅ 已实现功能

1. **完整的播放控制**
   - ▶️ 播放/暂停
   - ⏩ 快进/快退
   - 📊 进度条拖动
   - 🔊 音量调节
   - ⏱️ 实时显示播放进度和时长

2. **自动适配**
   - 自动适应不同视频分辨率
   - 支持横屏和竖屏视频
   - 智能缩放，保持画面比例

3. **性能优化**
   - 硬件加速解码
   - 自适应码率
   - 流畅的播放体验

## 使用方法

### 1. 打开视频

在主界面中：
- 点击任意视频缩略图（带有播放图标 ▶️ 的项）
- 自动进入视频详情页
- 视频播放器会自动加载

### 2. 播放控制

**基本操作：**
```
▶️ 播放按钮 - 开始播放视频
⏸️ 暂停按钮 - 暂停播放
```

**进度控制：**
```
拖动进度条 - 跳转到指定位置
点击进度条 - 快速跳转
```

**音量控制：**
```
点击音量图标 - 静音/取消静音
拖动音量条 - 调整音量大小
```

**全屏模式：**
```
点击全屏按钮 - 进入全屏播放
返回按钮 - 退出全屏
```

### 3. 查看视频信息

在播放器下方可以查看：
- 📄 文件名
- 📏 文件大小
- 📐 分辨率（如 1920x1080）
- ⏱️ 视频时长（如 5:23）
- 📅 创建时间
- 📂 文件路径

## 支持的视频格式

### 完全支持 ✅
- **MP4** (.mp4) - H.264/H.265 编码
- **3GP** (.3gp) - 移动设备常用格式
- **WebM** (.webm) - VP8/VP9 编码
- **MKV** (.mkv) - Matroska 容器

### 部分支持 ⚠️
- **AVI** (.avi) - 取决于编码格式
- **MOV** (.mov) - QuickTime 格式
- **FLV** (.flv) - Flash 视频

### 音频编解码器
- AAC
- MP3
- Opus
- Vorbis

### 视频编解码器
- H.264 (AVC)
- H.265 (HEVC)
- VP8
- VP9
- AV1

## 技术实现

### VideoPlayer.kt

```kotlin
// 主要组件：
1. ExoPlayer 实例 - 核心播放引擎
2. PlayerView - UI 显示组件
3. State 管理 - 播放状态追踪
4. DisposableEffect - 生命周期管理
```

**关键代码：**
```kotlin
val exoPlayer = remember {
    ExoPlayer.Builder(context).build().apply {
        val mediaItem = MediaItem.fromUri(uri)
        setMediaItem(mediaItem)
        prepare()
        playWhenReady = false  // 默认不自动播放
    }
}
```

### 自动释放资源

播放器会在以下情况自动释放：
- 关闭详情对话框
- 返回主界面
- 应用进入后台
- 组件销毁时

## 常见问题

### Q1: 视频无法播放？
**可能原因：**
1. 视频编码格式不支持
2. 文件损坏
3. 权限不足

**解决方案：**
- 检查视频格式是否在支持列表中
- 尝试用其他播放器打开验证文件完整性
- 确保已授予存储权限

### Q2: 播放卡顿？
**可能原因：**
1. 视频分辨率过高（如 4K）
2. 设备性能不足
3. 存储读取速度慢

**解决方案：**
- 关闭其他应用释放内存
- 使用较低分辨率的视频
- 将视频移动到内部存储

### Q3: 没有声音？
**检查项：**
- 设备音量是否打开
- 播放器是否静音
- 视频本身是否有音轨

### Q4: 无法快进/快退？
**可能原因：**
- 某些视频格式不支持 seek 操作
- 视频索引信息缺失

### Q5: 播放器闪退？
**解决方案：**
- 更新到最新版本
- 清除应用缓存
- 重新安装应用

## 性能建议

### 最佳体验配置

**推荐设备：**
- Android 8.0 或更高版本
- 2GB RAM 或更多
- 支持硬件解码

**推荐视频规格：**
- 分辨率：≤ 1080p
- 码率：≤ 5 Mbps
- 格式：MP4 (H.264)

### 电池优化

播放视频会消耗较多电量，建议：
- 降低屏幕亮度
- 关闭不必要的后台应用
- 使用有线耳机代替扬声器

## 开发者信息

### 使用的库

```gradle
// Media3 ExoPlayer
implementation 'androidx.media3:media3-exoplayer:1.1.1'
implementation 'androidx.media3:media3-ui:1.1.1'
```

### 主要类

1. **VideoPlayer.kt**
   - `VideoPlayer()` - 完整播放器组件
   - `SimpleVideoPlayer()` - 简化版播放器

2. **MediaDetailDialog.kt**
   - 集成视频播放器
   - 自动识别图片/视频

### 扩展建议

未来可以添加的功能：
- [ ] 播放速度调节（0.5x, 1x, 1.5x, 2x）
- [ ] 字幕支持
- [ ] 播放历史记录
- [ ] 视频剪辑功能
- [ ] 投屏功能（Chromecast）
- [ ] 后台播放（仅音频）

## 更新日志

### v1.0.1 (2025-10-03)
- ✅ 添加视频播放功能
- ✅ 集成 ExoPlayer
- ✅ 完整的播放控制界面
- ✅ 自动资源释放

### v1.0.0 (2025-10-03)
- ✅ 基础媒体浏览功能
- ✅ 图片预览
- ✅ 视频缩略图显示

---

**享受流畅的视频播放体验！** 🎬

