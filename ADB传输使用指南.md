# ADB传输使用指南

## 📋 目录
- [功能概述](#功能概述)
- [准备工作](#准备工作)
- [使用步骤](#使用步骤)
- [传输方式对比](#传输方式对比)
- [增量传输说明](#增量传输说明)
- [常见问题](#常见问题)
- [高级技巧](#高级技巧)

---

## 功能概述

MediaExplorer现在支持**两种传输方式**：

### 1. 📶 WiFi传输
- **速度**: 5-100 MB/s（取决于WiFi版本）
- **优点**: 无需数据线，操作简单
- **缺点**: 速度较慢，受网络影响
- **适用**: 少量文件（几十张照片）

### 2. 🔌 USB/ADB传输（推荐大量文件使用）
- **速度**: 30-150 MB/s（USB 2.0/3.0）
- **优点**: 速度快，稳定可靠
- **缺点**: 需要USB线和ADB工具
- **适用**: 大量文件（数百张照片/视频）

### 3. ✨ 增量传输
- 自动跟踪已传输的文件
- 只传输新文件或修改过的文件
- 避免重复传输，节省时间

---

## 准备工作

### 在电脑上安装ADB工具

#### Windows系统

1. **下载Android SDK Platform Tools**
   - 访问: https://developer.android.com/studio/releases/platform-tools
   - 下载 Windows 版本
   - 解压到任意目录（如 `C:\adb`）

2. **添加到环境变量（可选但推荐）**
   ```
   系统属性 → 环境变量 → Path → 新建 → 添加ADB目录
   ```

3. **验证安装**
   ```cmd
   adb version
   ```

#### macOS系统

1. **使用Homebrew安装（推荐）**
   ```bash
   brew install android-platform-tools
   ```

2. **或手动下载**
   - 访问: https://developer.android.com/studio/releases/platform-tools
   - 下载 macOS 版本
   - 解压并添加到PATH

3. **验证安装**
   ```bash
   adb version
   ```

#### Linux系统

1. **Ubuntu/Debian**
   ```bash
   sudo apt-get update
   sudo apt-get install android-tools-adb
   ```

2. **其他发行版**
   - 从官网下载Platform Tools
   - 或使用包管理器安装

---

## 使用步骤

### 第一步：在手机上操作

1. **启用USB调试**
   - 打开设置 → 关于手机
   - 连续点击"版本号"7次，启用开发者选项
   - 返回设置 → 开发者选项
   - 启用"USB调试"

2. **连接USB并授权**
   - 用USB线连接手机和电脑
   - 手机会弹出授权提示，点击"允许"

3. **选择文件**
   - 打开MediaExplorer应用
   - 点击右上角选择按钮进入选择模式
   - 点击要传输的照片/视频
   - 使用"全选"或"反选"快速选择

4. **选择传输方式**
   - 点击菜单 → "传输到电脑"
   - 选择"🔌 USB/ADB传输"
   - （可选）启用"增量传输"只传输新文件
   - 点击"下一步"

5. **启动ADB服务器**
   - 点击"启动ADB传输"
   - 界面会显示端口号（12345）
   - 保持应用打开

### 第二步：在电脑上操作

#### 方法A：使用Python脚本（推荐）

1. **确保已安装Python 3**
   ```bash
   python3 --version
   ```

2. **将`adb_transfer_client.py`复制到电脑**
   - 从项目根目录获取此文件
   - 或从GitHub下载

3. **运行传输脚本**
   ```bash
   # 默认保存到 ~/Downloads/MediaExplorer
   python3 adb_transfer_client.py
   
   # 或指定保存目录
   python3 adb_transfer_client.py /path/to/save
   ```

4. **等待传输完成**
   - 脚本会自动：
     - 设置ADB端口转发
     - 获取文件列表
     - 显示文件信息和进度
     - 下载所有文件
     - 显示统计信息

#### 方法B：手动使用ADB命令

如果不想使用Python脚本，可以手动操作：

1. **设置端口转发**
   ```bash
   adb forward tcp:12345 tcp:12345
   ```

2. **使用自定义客户端连接**
   - 连接到 `localhost:12345`
   - 发送命令获取文件列表和下载文件
   - 协议详见源码 `AdbTransferServer.kt`

### 第三步：完成传输

1. **验证文件**
   - 在电脑上检查下载的文件
   - 确认文件完整且可以打开

2. **剪切模式：删除原文件**
   - 在手机上点击"完成传输并删除"
   - 确认删除
   - 应用会：
     - 记录传输历史（用于增量传输）
     - 删除已传输的文件
     - 刷新媒体列表
     - 显示删除结果

⚠️ **警告**：删除操作不可逆，请务必确认文件已成功保存到电脑！

---

## 传输方式对比

| 特性 | WiFi传输 | USB/ADB传输 |
|------|----------|-------------|
| **速度** | 5-100 MB/s | 30-150 MB/s |
| **稳定性** | 受网络影响 | 非常稳定 |
| **需要数据线** | ❌ 否 | ✅ 是 |
| **需要同网络** | ✅ 是 | ❌ 否 |
| **需要安装工具** | ❌ 否 | ✅ 是 |
| **操作复杂度** | 简单 | 中等 |
| **支持增量传输** | ✅ 是 | ✅ 是 |
| **适用场景** | 少量文件 | 大量文件 |
| **电量消耗** | 较高 | 低（充电中） |

### 速度测试示例

传输100张照片（约2GB）：
- **WiFi (802.11n)**: 约4-6分钟
- **WiFi (802.11ac)**: 约1-2分钟
- **USB 2.0**: 约1分钟
- **USB 3.0**: 约20-30秒

---

## 增量传输说明

### 什么是增量传输？

增量传输会记录所有已成功传输过的文件，下次传输时自动跳过这些文件，只传输新文件或修改过的文件。

### 工作原理

1. **传输记录**
   - 每次成功传输后，记录文件的：
     - 文件路径
     - 文件大小
     - 修改时间
     - 传输时间

2. **智能识别**
   - 下次传输时，检查文件是否：
     - 已存在传输记录
     - 大小和修改时间是否匹配
   - 如果都匹配，则跳过该文件

3. **自动更新**
   - 如果文件被编辑过（修改时间或大小改变）
   - 会被识别为新文件，重新传输

### 使用场景

#### 场景1：每日备份
```
第1天：全选 → 启用增量传输 → 传输100张照片
第2天：全选 → 启用增量传输 → 只传输今天拍的10张新照片
第3天：全选 → 启用增量传输 → 只传输今天拍的15张新照片
```

#### 场景2：分批传输
```
步骤1：选择"照片"文件夹 → 启用增量传输 → 传输
步骤2：选择"视频"文件夹 → 启用增量传输 → 传输
步骤3：全选 → 启用增量传输 → 检查是否有遗漏
```

### 管理传输历史

传输历史存储在应用的私有数据中，你可以：
- 查看已传输文件数量（显示在选择对话框中）
- 清除传输历史（在设置中，未来功能）

---

## 常见问题

### Q1: 提示"找不到ADB命令"怎么办？

**A:** 
1. 确认已安装Android SDK Platform Tools
2. 检查ADB是否在PATH环境变量中
3. 尝试使用ADB的完整路径：
   ```bash
   /path/to/adb forward tcp:12345 tcp:12345
   python3 adb_transfer_client.py
   ```

### Q2: 手机连接后，电脑无法识别怎么办？

**A:**
1. 检查USB调试是否已启用
2. 尝试更换USB接口或数据线
3. 运行 `adb devices` 查看设备列表
4. 如果显示"unauthorized"，在手机上重新授权

### Q3: 传输速度很慢怎么办？

**A:**
1. **USB传输慢**：
   - 检查是否使用USB 3.0接口（蓝色）
   - 更换质量更好的数据线
   - 关闭其他占用USB带宽的设备

2. **WiFi传输慢**：
   - 靠近路由器
   - 切换到5GHz频段
   - 关闭其他占用网络的应用
   - 考虑使用USB/ADB传输

### Q4: 增量传输没有跳过已传输的文件？

**A:**
1. 确认首次传输后点击了"完成传输并删除"或"记录传输"
2. 检查文件是否被修改过（修改时间或大小变化）
3. 如果传输历史被清除，需要重新传输

### Q5: 传输中断了怎么办？

**A:**
1. **WiFi传输中断**：
   - 重新启动传输
   - 启用增量传输，跳过已下载的文件

2. **ADB传输中断**：
   - 检查USB连接
   - 重新运行Python脚本
   - 脚本会自动从中断处继续

### Q6: 删除文件后能恢复吗？

**A:** 
不能。删除是永久性的，无法恢复。请务必在删除前确认文件已成功保存到电脑。

建议：
1. 先检查几个文件确认可以正常打开
2. 对重要文件进行二次备份
3. 考虑先不删除，等确认一切正常后再删

### Q7: 可以同时使用WiFi和ADB传输吗？

**A:** 
不可以。一次只能使用一种传输方式。但你可以：
1. 用WiFi传输急需的文件
2. 稍后用ADB传输大量文件

---

## 高级技巧

### 技巧1：快速选择

使用选择模式的高级功能：
```
1. 进入选择模式
2. 点击"全选"选择所有文件
3. 点击"反选"反转选择
4. 单独取消不想传输的文件
```

### 技巧2：按类型传输

```
步骤1：切换到"照片"标签 → 全选 → 传输所有照片
步骤2：切换到"视频"标签 → 全选 → 传输所有视频
```

### 技巧3：自动化备份脚本

创建定时任务自动备份（macOS/Linux）：

```bash
#!/bin/bash
# auto_backup.sh

# 连接手机时自动运行
adb wait-for-device
python3 /path/to/adb_transfer_client.py ~/Pictures/PhoneBackup
```

### 技巧4：批量重命名（未来功能）

传输后可以在电脑上使用脚本批量重命名：

```python
# rename_by_date.py
import os
from PIL import Image
from datetime import datetime

for file in os.listdir('.'):
    if file.endswith(('.jpg', '.png')):
        img = Image.open(file)
        exif = img._getexif()
        # 根据EXIF日期重命名
        # ...
```

### 技巧5：传输前预览

使用详情页面查看文件信息：
1. 退出选择模式
2. 点击文件查看详情
3. 确认是否需要传输
4. 重新进入选择模式传输

---

## 安全与隐私

### 数据安全
- ✅ 所有传输在本地进行（WiFi局域网或USB直连）
- ✅ 不经过互联网，无第三方服务器
- ✅ 传输历史仅存储在手机本地
- ✅ 可随时清除传输历史

### 建议
1. 仅在可信网络中使用WiFi传输
2. 传输完成后及时关闭服务器
3. 定期清理电脑上的备份文件
4. 敏感文件传输完成后立即删除

---

## 更新日志

### v2.0 (2025-10-05)
- ✨ 新增ADB/USB传输方式
- ✨ 新增增量传输功能
- ✨ 新增传输历史记录
- ✨ 新增Python传输客户端
- 🎨 优化传输方式选择界面
- 📝 完善使用文档

---

## 反馈与支持

遇到问题？有改进建议？

- 📧 提交 GitHub Issue
- 💬 应用内反馈
- 📖 查看完整文档

---

**祝你传输愉快！** 📱➡️💻🚀

